(this["webpackJsonplittle-fox-game"]=this["webpackJsonplittle-fox-game"]||[]).push([[16],{748:function(t,e,r){"use strict";function i(t){return i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},i(t)}function n(t,e,r){return n="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=i(t)););return t}(t,e);if(n){var a=Object.getOwnPropertyDescriptor(n,e);return a.get?a.get.call(r):a.value}},n(t,e,r||t)}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}r.d(e,"a",(function(){return lt})),r.d(e,"b",(function(){return ot})),r.d(e,"c",(function(){return ft}));var o=r(730),s=r(729);function u(t,e){return u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},u(t,e)}function c(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}function l(t){return l="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function h(t,e){return!e||"object"!==l(e)&&"function"!==typeof e?a(t):e}function f(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=i(t);if(e){var a=i(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return h(this,r)}}var y,p,v=r(65),d=r(126),_=r(68),m=r(71),x=r(73),g=r(746),T=r(740),b=r(753),k=r(728),w=r(739),j=(r(745),function(t){c(r,t);var e=f(r);function r(){var t,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Object(s.a)(this,r),(t=e.call(this))._buffer=new v.p(null,i,!1),t._indexBuffer=new v.p(null,i,!0),t.addAttribute("aVertexPosition",t._buffer,3,!1,d.r.FLOAT).addAttribute("aTextureCoord",t._buffer,2,!1,d.r.FLOAT).addAttribute("aColor",t._buffer,4,!0,d.r.UNSIGNED_BYTE).addAttribute("aTextureId",t._buffer,1,!0,d.r.FLOAT).addIndex(t._indexBuffer),t}return r}(v.C)),I=function(){function t(){Object(s.a)(this,t)}return Object(o.a)(t,null,[{key:"create",value:function(t){var e=Object.assign({vertex:"precision highp float;\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\ngl_Position.xyw = projectionMatrix * aVertexPosition;\ngl_Position.z = 0.0;\n\nvTextureCoord = aTextureCoord;\nvTextureId = aTextureId;\nvColor = aColor;\n}\n",fragment:"\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\nvec4 color;\n%forloop%\ngl_FragColor = color * vColor;\n}",geometryClass:j,vertexSize:7},t),r=e.vertex,i=e.fragment,n=e.vertexSize,a=e.geometryClass;return function(t){c(u,t);var e=f(u);function u(t){var o;return Object(s.a)(this,u),(o=e.call(this,t)).shaderGenerator=new v.m(r,i),o.geometryClass=a,o.vertexSize=n,o}return Object(o.a)(u,[{key:"packInterleavedGeometry",value:function(t,e,r,i,n){var a=e.uint32View,o=e.float32View,s=i/this.vertexSize,u=t.uvs,c=t.indices,l=t.vertexData,h=t.vertexData2d,f=t._texture.baseTexture._batchLocation,y=Math.min(t.worldAlpha,1),p=y<1&&t._texture.baseTexture.alphaMode?Object(_.premultiplyTint)(t._tintRGB,y):t._tintRGB+(255*y<<24);if(h)for(var v=0,d=0;d<h.length;d+=3,v+=2)o[i++]=h[d],o[i++]=h[d+1],o[i++]=h[d+2],o[i++]=u[v],o[i++]=u[v+1],a[i++]=p,o[i++]=f;else for(var m=0;m<l.length;m+=2)o[i++]=l[m],o[i++]=l[m+1],o[i++]=1,o[i++]=u[m],o[i++]=u[m+1],a[i++]=p,o[i++]=f;for(var x=0;x<c.length;x++)r[n++]=s+c[x]}}]),u}(v.a)}}]),t}(),D=function(){function t(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(s.a)(this,t),t.prototype.__init.call(this),this.legacy=e,r&&(this.enabled=!0),this.legacy.proj=this}return Object(o.a)(t,[{key:"__init",value:function(){this._enabled=!1}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"clear",value:function(){}}]),t}();function M(t){var e=this.proj,r=this,i=t._worldID,n=r.localTransform,a=e.scaleAfterAffine&&e.affine>=2;r._localID!==r._currentLocalID&&(a?(n.a=r._cx,n.b=r._sx,n.c=r._cy,n.d=r._sy,n.tx=r.position._x,n.ty=r.position._y):(n.a=r._cx*r.scale._x,n.b=r._sx*r.scale._x,n.c=r._cy*r.scale._y,n.d=r._sy*r.scale._y,n.tx=r.position._x-(r.pivot._x*n.a+r.pivot._y*n.c),n.ty=r.position._y-(r.pivot._x*n.b+r.pivot._y*n.d)),r._currentLocalID=r._localID,e._currentProjID=-1);var o=e._projID;if(e._currentProjID!==o&&(e._currentProjID=o,e.updateLocalTransform(n),r._parentID=-1),r._parentID!==i){var s=t.proj;s&&!s._affine?e.world.setToMult(s.world,e.local):e.world.setToMultLegacy(t.worldTransform,e.local);var u=r.worldTransform;e.world.copyTo(u,e._affine,e.affinePreserveOrientation),a&&(u.a*=r.scale._x,u.b*=r.scale._x,u.c*=r.scale._y,u.d*=r.scale._y,u.tx-=r.pivot._x*u.a+r.pivot._y*u.c,u.ty-=r.pivot._x*u.b+r.pivot._y*u.d),r._parentID=i,r._worldID++}}!function(t){t[t.NONE=0]="NONE";t[t.BEFORE_PROJ=4]="BEFORE_PROJ";t[t.PROJ=5]="PROJ";t[t.ALL=9]="ALL"}(y||(y={})),function(t){t[t.NONE=0]="NONE";t[t.FREE=1]="FREE";t[t.AXIS_X=2]="AXIS_X";t[t.AXIS_Y=3]="AXIS_Y";t[t.POINT=4]="POINT";t[t.AXIS_XR=5]="AXIS_XR"}(p||(p={}));var O=function(t){c(r,t);var e=f(r);function r(){var t;Object(s.a)(this,r);for(var i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return t=e.call.apply(e,[this].concat(n)),r.prototype.__init.call(a(t)),r.prototype.__init2.call(a(t)),r.prototype.__init3.call(a(t)),r.prototype.__init4.call(a(t)),r.prototype.__init5.call(a(t)),t}return Object(o.a)(r,[{key:"updateLocalTransform",value:function(t){}},{key:"__init",value:function(){this._projID=0}},{key:"__init2",value:function(){this._currentProjID=-1}},{key:"__init3",value:function(){this._affine=p.NONE}},{key:"__init4",value:function(){this.affinePreserveOrientation=!1}},{key:"__init5",value:function(){this.scaleAfterAffine=!0}},{key:"affine",get:function(){return this._affine},set:function(t){this._affine!==t&&(this._affine=t,this._currentProjID=-1,this.legacy._currentLocalID=-1)}},{key:"enabled",set:function(t){t!==this._enabled&&(this._enabled=t,t?(this.legacy.updateTransform=M,this.legacy._parentID=-1):(this.legacy.updateTransform=m.m.prototype.updateTransform,this.legacy._parentID=-1))}},{key:"clear",value:function(){this._currentProjID=-1,this._projID=0}}]),r}(D),C=function(t){c(r,t);var e=f(r);function r(){var t;Object(s.a)(this,r);for(var i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return t=e.call.apply(e,[this].concat(n)),r.prototype.__init.call(a(t)),r.prototype.__init2.call(a(t)),t}return Object(o.a)(r,[{key:"__init",value:function(){this.forceMaxTextures=0}},{key:"getUniforms",value:function(t){return this.defUniforms}},{key:"syncUniforms",value:function(t){if(t){var e=this._shader;for(var r in t)e.uniforms[r]=t[r]}}},{key:"__init2",value:function(){this.defUniforms={}}},{key:"buildDrawCalls",value:function(t,e,r){var i=this,n=this._bufferedElements,a=this._attributeBuffer,o=this._indexBuffer,s=this.vertexSize,u=v.a._drawCallPool,c=this._dcIndex,l=this._aIndex,h=this._iIndex,f=u[c];f.start=this._iIndex,f.texArray=t;for(var y=e;y<r;++y){var p=n[y],d=p._texture.baseTexture,m=_.premultiplyBlendMode[d.alphaMode?1:0][p.blendMode],x=this.getUniforms(p);n[y]=null,e<y&&(f.blend!==m||f.uniforms!==x)&&(f.size=h-f.start,e=y,(f=u[++c]).texArray=t,f.start=h),this.packInterleavedGeometry(p,a,o,l,h),l+=p.vertexData.length/2*s,h+=p.indices.length,f.blend=m,f.uniforms=x}e<r&&(f.size=h-f.start,++c),i._dcIndex=c,i._aIndex=l,i._iIndex=h}},{key:"drawBatches",value:function(){for(var t=this._dcIndex,e=this.renderer,r=e.gl,i=e.state,n=e.shader,a=v.a._drawCallPool,o=null,s=null,u=0;u<t;u++){var c=a[u],l=c.texArray,h=c.type,f=c.size,y=c.start,p=c.blend,d=c.uniforms;s!==l&&(s=l,this.bindAndClearTexArray(l)),o!==d&&(o=d,this.syncUniforms(d),n.syncUniformGroup(this._shader.uniformGroup)),this.state.blendMode=p,i.set(this.state),r.drawElements(h,f,r.UNSIGNED_SHORT,2*y)}}},{key:"contextChange",value:function(){if(!this.forceMaxTextures)return n(i(r.prototype),"contextChange",this).call(this),void this.syncUniforms(this.defUniforms);var t=this;t.MAX_TEXTURES=this.forceMaxTextures,this._shader=t.shaderGenerator.generateShader(this.MAX_TEXTURES),this.syncUniforms(this.defUniforms);for(var e=0;e<t._packedGeometryPoolSize;e++)t._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}}]),r}(v.a);v.S.registerPlugin("batch2d",I.create({}));var A=[1,0,0,0,1,0,0,0,1],F=function(){function t(e){Object(s.a)(this,t),t.prototype.__init.call(this),this.mat3=new Float64Array(e||A)}return Object(o.a)(t,[{key:"__init",value:function(){this.floatArray=null}},{key:"a",get:function(){return this.mat3[0]/this.mat3[8]},set:function(t){this.mat3[0]=t*this.mat3[8]}},{key:"b",get:function(){return this.mat3[1]/this.mat3[8]},set:function(t){this.mat3[1]=t*this.mat3[8]}},{key:"c",get:function(){return this.mat3[3]/this.mat3[8]},set:function(t){this.mat3[3]=t*this.mat3[8]}},{key:"d",get:function(){return this.mat3[4]/this.mat3[8]},set:function(t){this.mat3[4]=t*this.mat3[8]}},{key:"tx",get:function(){return this.mat3[6]/this.mat3[8]},set:function(t){this.mat3[6]=t*this.mat3[8]}},{key:"ty",get:function(){return this.mat3[7]/this.mat3[8]},set:function(t){this.mat3[7]=t*this.mat3[8]}},{key:"set",value:function(t,e,r,i,n,a){var o=this.mat3;return o[0]=t,o[1]=e,o[2]=0,o[3]=r,o[4]=i,o[5]=0,o[6]=n,o[7]=a,o[8]=1,this}},{key:"toArray",value:function(t,e){this.floatArray||(this.floatArray=new Float32Array(9));var r=e||this.floatArray,i=this.mat3;return t?(r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[4]=i[4],r[5]=i[5],r[6]=i[6],r[7]=i[7],r[8]=i[8]):(r[0]=i[0],r[1]=i[3],r[2]=i[6],r[3]=i[1],r[4]=i[4],r[5]=i[7],r[6]=i[2],r[7]=i[5],r[8]=i[8]),r}},{key:"apply",value:function(t,e){e=e||new m.g;var r=this.mat3,i=t.x,n=t.y,a=1/(r[2]*i+r[5]*n+r[8]);return e.x=a*(r[0]*i+r[3]*n+r[6]),e.y=a*(r[1]*i+r[4]*n+r[7]),e}},{key:"translate",value:function(t,e){var r=this.mat3;return r[0]+=t*r[2],r[1]+=e*r[2],r[3]+=t*r[5],r[4]+=e*r[5],r[6]+=t*r[8],r[7]+=e*r[8],this}},{key:"scale",value:function(t,e){var r=this.mat3;return r[0]*=t,r[1]*=e,r[3]*=t,r[4]*=e,r[6]*=t,r[7]*=e,this}},{key:"scaleAndTranslate",value:function(t,e,r,i){var n=this.mat3;n[0]=t*n[0]+r*n[2],n[1]=e*n[1]+i*n[2],n[3]=t*n[3]+r*n[5],n[4]=e*n[4]+i*n[5],n[6]=t*n[6]+r*n[8],n[7]=e*n[7]+i*n[8]}},{key:"applyInverse",value:function(t,e){e=e||new m.g;var r=this.mat3,i=t.x,n=t.y,a=r[0],o=r[3],s=r[6],u=r[1],c=r[4],l=r[7],h=r[2],f=r[5],y=r[8],p=(y*c-l*f)*i+(-y*o+s*f)*n+(l*o-s*c),v=(-y*u+l*h)*i+(y*a-s*h)*n+(-l*a+s*u),d=(f*u-c*h)*i+(-f*a+o*h)*n+(c*a-o*u);return e.x=p/d,e.y=v/d,e}},{key:"invert",value:function(){var t=this.mat3,e=t[0],r=t[1],i=t[2],n=t[3],a=t[4],o=t[5],s=t[6],u=t[7],c=t[8],l=c*a-o*u,h=-c*n+o*s,f=u*n-a*s,y=e*l+r*h+i*f;return y?(y=1/y,t[0]=l*y,t[1]=(-c*r+i*u)*y,t[2]=(o*r-i*a)*y,t[3]=h*y,t[4]=(c*e-i*s)*y,t[5]=(-o*e+i*n)*y,t[6]=f*y,t[7]=(-u*e+r*s)*y,t[8]=(a*e-r*n)*y,this):this}},{key:"identity",value:function(){var t=this.mat3;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this}},{key:"clone",value:function(){return new t(this.mat3)}},{key:"copyTo2dOr3d",value:function(t){var e=this.mat3,r=t.mat3;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],t}},{key:"copyTo",value:function(t,e,r){var i=this.mat3,n=1/i[8],a=i[6]*n,o=i[7]*n;if(t.a=(i[0]-i[2]*a)*n,t.b=(i[1]-i[2]*o)*n,t.c=(i[3]-i[5]*a)*n,t.d=(i[4]-i[5]*o)*n,t.tx=a,t.ty=o,e>=2){var s=t.a*t.d-t.b*t.c;r||(s=Math.abs(s)),e===p.POINT?(s=s>0?1:-1,t.a=s,t.b=0,t.c=0,t.d=s):e===p.AXIS_X?(s/=Math.sqrt(t.b*t.b+t.d*t.d),t.c=0,t.d=s):e===p.AXIS_Y?(s/=Math.sqrt(t.a*t.a+t.c*t.c),t.a=s,t.c=0):e===p.AXIS_XR&&(t.a=t.d*s,t.c=-t.b*s)}return t}},{key:"copyFrom",value:function(t){var e=this.mat3;return e[0]=t.a,e[1]=t.b,e[2]=0,e[3]=t.c,e[4]=t.d,e[5]=0,e[6]=t.tx,e[7]=t.ty,e[8]=1,this}},{key:"setToMultLegacy",value:function(t,e){var r=this.mat3,i=e.mat3,n=t.a,a=t.b,o=t.c,s=t.d,u=t.tx,c=t.ty,l=i[0],h=i[1],f=i[2],y=i[3],p=i[4],v=i[5],d=i[6],_=i[7],m=i[8];return r[0]=l*n+h*o+f*u,r[1]=l*a+h*s+f*c,r[2]=f,r[3]=y*n+p*o+v*u,r[4]=y*a+p*s+v*c,r[5]=v,r[6]=d*n+_*o+m*u,r[7]=d*a+_*s+m*c,r[8]=m,this}},{key:"setToMultLegacy2",value:function(t,e){var r=this.mat3,i=t.mat3,n=i[0],a=i[1],o=i[2],s=i[3],u=i[4],c=i[5],l=i[6],h=i[7],f=i[8],y=e.a,p=e.b,v=e.c,d=e.d,_=e.tx,m=e.ty;return r[0]=y*n+p*s,r[1]=y*a+p*u,r[2]=y*o+p*c,r[3]=v*n+d*s,r[4]=v*a+d*u,r[5]=v*o+d*c,r[6]=_*n+m*s+l,r[7]=_*a+m*u+h,r[8]=_*o+m*c+f,this}},{key:"setToMult",value:function(t,e){var r=this.mat3,i=t.mat3,n=e.mat3,a=i[0],o=i[1],s=i[2],u=i[3],c=i[4],l=i[5],h=i[6],f=i[7],y=i[8],p=n[0],v=n[1],d=n[2],_=n[3],m=n[4],x=n[5],g=n[6],T=n[7],b=n[8];return r[0]=p*a+v*u+d*h,r[1]=p*o+v*c+d*f,r[2]=p*s+v*l+d*y,r[3]=_*a+m*u+x*h,r[4]=_*o+m*c+x*f,r[5]=_*s+m*l+x*y,r[6]=g*a+T*u+b*h,r[7]=g*o+T*c+b*f,r[8]=g*s+T*l+b*y,this}},{key:"prepend",value:function(t){return t.mat3?this.setToMult(t,this):this.setToMultLegacy(t,this)}}],[{key:"__initStatic",value:function(){this.IDENTITY=new t}},{key:"__initStatic2",value:function(){this.TEMP_MATRIX=new t}}]),t}();F.__initStatic(),F.__initStatic2();var S="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec3 vTextureCoord;\n\nvoid main(void)\n{\ngl_Position.xyw = projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0);\n\nvTextureCoord = uTransform * vec3(aTextureCoord, 1.0);\n}\n",P=new F,z=function(t){c(r,t);var e=f(r);function r(t){var i;Object(s.a)(this,r),i=e.call(this,t),r.prototype.__init.call(a(i));var n={globals:i.renderer.globalUniforms};return i.shader=v.W.from(S,"\nvarying vec3 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\nvec2 coord = mod(vTextureCoord.xy / vTextureCoord.z - uClampOffset, vec2(1.0, 1.0)) + uClampOffset;\ncoord = (uMapCoord * vec3(coord, 1.0)).xy;\ncoord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\nvec4 sample = texture2D(uSampler, coord);\ngl_FragColor = sample * uColor;\n}\n",n),i.simpleShader=v.W.from(S,"\nvarying vec3 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\nvec4 sample = texture2D(uSampler, vTextureCoord.xy / vTextureCoord.z);\ngl_FragColor = sample * uColor;\n}\n",n),i}return Object(o.a)(r,[{key:"__init",value:function(){this.quad=new v.O}},{key:"render",value:function(t){var e=this.renderer,r=this.quad,i=r.vertices;i[0]=i[6]=t._width*-t.anchor.x,i[1]=i[3]=t._height*-t.anchor.y,i[2]=i[4]=t._width*(1-t.anchor.x),i[5]=i[7]=t._height*(1-t.anchor.y),t.uvRespectAnchor&&((i=r.uvs)[0]=i[6]=-t.anchor.x,i[1]=i[3]=-t.anchor.y,i[2]=i[4]=1-t.anchor.x,i[5]=i[7]=1-t.anchor.y),r.invalidate();var n=t._texture,a=n.baseTexture,o=t.tileProj.world,s=t.uvMatrix,u=a.isPowerOfTwo&&n.frame.width===a.width&&n.frame.height===a.height;u&&(a._glTextures[e.CONTEXT_UID]?u=a.wrapMode!==d.s.CLAMP:a.wrapMode===d.s.CLAMP&&(a.wrapMode=d.s.REPEAT));var c=u?this.simpleShader:this.shader;P.identity(),P.scale(n.width,n.height),P.prepend(o),P.scale(1/t._width,1/t._height),P.invert(),u?P.prepend(s.mapCoord):(c.uniforms.uMapCoord=s.mapCoord.toArray(!0),c.uniforms.uClampFrame=s.uClampFrame,c.uniforms.uClampOffset=s.uClampOffset),c.uniforms.uTransform=P.toArray(!0),c.uniforms.uColor=Object(_.premultiplyTintToRgba)(t.tint,t.worldAlpha,c.uniforms.uColor,a.premultiplyAlpha),c.uniforms.translationMatrix=t.worldTransform.toArray(!0),c.uniforms.uSampler=n,e.shader.bind(c,!1),e.geometry.bind(r,void 0),e.state.setBlendMode(Object(_.correctBlendMode)(t.blendMode,a.premultiplyAlpha)),e.geometry.draw(d.f.TRIANGLES,6,0)}}]),r}(v.K),L=new m.g,V=[new m.g,new m.g,new m.g,new m.g],N=new m.j,q=new F,B=function(t){c(r,t);var e=f(r);function r(t,i){var n;return Object(s.a)(this,r),n=e.call(this,t,i),r.prototype.__init.call(a(n)),r.prototype.__init2.call(a(n)),r.prototype.__init3.call(a(n)),n.local=new F,n.world=new F,n}return Object(o.a)(r,[{key:"__init",value:function(){this.matrix=new F}},{key:"__init2",value:function(){this.pivot=new m.e(this.onChange,this,0,0)}},{key:"__init3",value:function(){this.reverseLocalOrder=!1}},{key:"onChange",value:function(){var t=this.pivot,e=this.matrix.mat3;e[6]=-(t._x*e[0]+t._y*e[3]),e[7]=-(t._x*e[1]+t._y*e[4]),this._projID++}},{key:"setAxisX",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=t.x,i=t.y,n=Math.sqrt(r*r+i*i),a=this.matrix.mat3;a[0]=r/n,a[1]=i/n,a[2]=e/n,this.onChange()}},{key:"setAxisY",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=t.x,i=t.y,n=Math.sqrt(r*r+i*i),a=this.matrix.mat3;a[3]=r/n,a[4]=i/n,a[5]=e/n,this.onChange()}},{key:"mapSprite",value:function(t,e){var r=t.texture;N.x=-t.anchor.x*r.orig.width,N.y=-t.anchor.y*r.orig.height,N.width=r.orig.width,N.height=r.orig.height,this.mapQuad(N,e)}},{key:"mapQuad",value:function(t,e){V[0].set(t.x,t.y),V[1].set(t.x+t.width,t.y),V[2].set(t.x+t.width,t.y+t.height),V[3].set(t.x,t.y+t.height);var r=1,i=2,n=3;if(0!==function(t,e,r,i,n){var a=e.x-t.x,o=r.x-i.x,s=r.x-t.x,u=e.y-t.y,c=r.y-i.y,l=r.y-t.y,h=a*c-u*o;if(Math.abs(h)<1e-7)return n.x=a,n.y=u,0;var f=(s*c-l*o)/h,y=(a*l-u*s)/h;return y<1e-6||y-1>-1e-6?-1:(n.x=t.x+f*(e.x-t.x),n.y=t.y+f*(e.y-t.y),1)}(e[0],e[2],e[1],e[3],L)){r=1,i=3,n=2;var a=Math.sqrt((e[0].x-L.x)*(e[0].x-L.x)+(e[0].y-L.y)*(e[0].y-L.y)),o=Math.sqrt((e[r].x-L.x)*(e[r].x-L.x)+(e[r].y-L.y)*(e[r].y-L.y)),s=Math.sqrt((e[i].x-L.x)*(e[i].x-L.x)+(e[i].y-L.y)*(e[i].y-L.y)),u=Math.sqrt((e[n].x-L.x)*(e[n].x-L.x)+(e[n].y-L.y)*(e[n].y-L.y)),c=(a+u)/u,l=(o+s)/s,h=(o+s)/o,f=this.matrix.mat3;f[0]=V[0].x*c,f[1]=V[0].y*c,f[2]=c,f[3]=V[r].x*l,f[4]=V[r].y*l,f[5]=l,f[6]=V[i].x*h,f[7]=V[i].y*h,f[8]=h,this.matrix.invert(),(f=q.mat3)[0]=e[0].x,f[1]=e[0].y,f[2]=1,f[3]=e[r].x,f[4]=e[r].y,f[5]=1,f[6]=e[i].x,f[7]=e[i].y,f[8]=1,this.matrix.setToMult(q,this.matrix),this._projID++}}},{key:"updateLocalTransform",value:function(t){0!==this._projID?this.reverseLocalOrder?this.local.setToMultLegacy2(this.matrix,t):this.local.setToMultLegacy(t,this.matrix):this.local.copyFrom(t)}},{key:"clear",value:function(){n(i(r.prototype),"clear",this).call(this),this.matrix.identity(),this.pivot.set(0,0)}}]),r}(O);function U(){return this.proj.affine?this.transform.worldTransform:this.proj.world}var R=function(t){c(r,t);var e=f(r);function r(){var t;return Object(s.a)(this,r),(t=e.call(this)).proj=new B(t.transform),t}return Object(o.a)(r,[{key:"toLocal",value:function(t,e,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:y.ALL;return e&&(t=e.toGlobal(t,r,i)),i||this._recursivePostUpdateTransform(),n>=y.PROJ?(i||this.displayObjectUpdateTransform(),this.proj.affine?this.transform.worldTransform.applyInverse(t,r):this.proj.world.applyInverse(t,r)):(this.parent?r=this.parent.worldTransform.applyInverse(t,r):(r.x=t.x,r.y=t.y),n===y.NONE?r:this.transform.localTransform.applyInverse(r,r))}},{key:"worldTransform",get:function(){return this.proj.affine?this.transform.worldTransform:this.proj.world}}]),r}(x.b),E=R.prototype.toLocal,X=function(t){c(r,t);var e=f(r);function r(t,i,n,o){var u;return Object(s.a)(this,r),u=e.call(this,t,i,n,o),r.prototype.__init.call(a(u)),u.proj=new B(u.transform),u}return Object(o.a)(r,[{key:"__init",value:function(){this.vertexData2d=null}},{key:"calculateVertices",value:function(){if(this.proj._affine)return this.vertexData2d=null,void n(i(r.prototype),"calculateVertices",this).call(this);var t=this.geometry,e=t.buffers[0].data,a=this;if(t.vertexDirtyId!==a.vertexDirty||a._transformID!==a.transform._worldID){a._transformID=a.transform._worldID,a.vertexData.length!==e.length&&(a.vertexData=new Float32Array(e.length)),this.vertexData2d&&this.vertexData2d.length===3*e.length/2||(this.vertexData2d=new Float32Array(3*e.length));for(var o=this.proj.world.mat3,s=this.vertexData2d,u=a.vertexData,c=0;c<u.length/2;c++){var l=e[2*c],h=e[2*c+1],f=o[0]*l+o[3]*h+o[6],y=o[1]*l+o[4]*h+o[7],p=o[2]*l+o[5]*h+o[8];s[3*c]=f,s[3*c+1]=y,s[3*c+2]=p,u[2*c]=f/p,u[2*c+1]=y/p}a.vertexDirty=t.vertexDirtyId}}},{key:"_renderDefault",value:function(t){var e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.program.uniformData.translationMatrix&&(e.uniforms.translationMatrix=this.worldTransform.toArray(!0)),t.shader.bind(e,!1),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}},{key:"toLocal",value:function(t,e,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:y.ALL;return E.call(this,t,e,r,i,n)}},{key:"worldTransform",get:function(){return this.proj.affine?this.transform.worldTransform:this.proj.world}}],[{key:"__initStatic",value:function(){this.defaultVertexShader="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\ngl_Position.xyw = projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0);\ngl_Position.z = 0.0;\n\nvTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n"}},{key:"__initStatic2",value:function(){this.defaultFragmentShader="\nvarying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\ngl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}"}}]),r}(T.a);X.__initStatic(),X.__initStatic2();var G=function(t){c(r,t);var e=f(r);function r(t){var i;return Object(s.a)(this,r),i=e.call(this,t),r.prototype.__init.call(a(i)),i.proj=new B(i.transform),i.pluginName="batch2d",i}return Object(o.a)(r,[{key:"__init",value:function(){this.vertexData2d=null}},{key:"_calculateBounds",value:function(){this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData)}},{key:"calculateVertices",value:function(){var t=this._texture;if(this.proj._affine)return this.vertexData2d=null,void n(i(r.prototype),"calculateVertices",this).call(this);this.vertexData2d||(this.vertexData2d=new Float32Array(12));var e=this.transform._worldID,a=t._updateID;if(this._transformID!==e||this._textureID!==a){this._textureID!==a&&(this.uvs=t._uvs.uvsFloat32),this._transformID=e,this._textureID=a;var o,s,u,c,l=this.proj.world.mat3,h=this.vertexData2d,f=this.vertexData,y=t.trim,p=t.orig,v=this._anchor;y?(o=(s=y.x-v._x*p.width)+y.width,u=(c=y.y-v._y*p.height)+y.height):(o=(s=-v._x*p.width)+p.width,u=(c=-v._y*p.height)+p.height),h[0]=l[0]*s+l[3]*c+l[6],h[1]=l[1]*s+l[4]*c+l[7],h[2]=l[2]*s+l[5]*c+l[8],h[3]=l[0]*o+l[3]*c+l[6],h[4]=l[1]*o+l[4]*c+l[7],h[5]=l[2]*o+l[5]*c+l[8],h[6]=l[0]*o+l[3]*u+l[6],h[7]=l[1]*o+l[4]*u+l[7],h[8]=l[2]*o+l[5]*u+l[8],h[9]=l[0]*s+l[3]*u+l[6],h[10]=l[1]*s+l[4]*u+l[7],h[11]=l[2]*s+l[5]*u+l[8],f[0]=h[0]/h[2],f[1]=h[1]/h[2],f[2]=h[3]/h[5],f[3]=h[4]/h[5],f[4]=h[6]/h[8],f[5]=h[7]/h[8],f[6]=h[9]/h[11],f[7]=h[10]/h[11]}}},{key:"calculateTrimmedVertices",value:function(){if(this.proj._affine)n(i(r.prototype),"calculateTrimmedVertices",this).call(this);else{var t=this.transform._worldID,e=this._texture._updateID,a=this;if(a.vertexTrimmedData){if(a._transformTrimmedID===t&&this._textureTrimmedID===e)return}else a.vertexTrimmedData=new Float32Array(8);a._transformTrimmedID=t,this._textureTrimmedID=e;var o=this._texture,s=a.vertexTrimmedData,u=o.orig,c=this.tileProj?this._width:u.width,l=this.tileProj?this._height:u.height,h=this._anchor,f=this.proj.world.mat3,y=-h._x*c,p=y+c,v=-h._y*l,d=v+l,_=1/(f[2]*y+f[5]*v+f[8]);s[0]=_*(f[0]*y+f[3]*v+f[6]),s[1]=_*(f[1]*y+f[4]*v+f[7]),_=1/(f[2]*p+f[5]*v+f[8]),s[2]=_*(f[0]*p+f[3]*v+f[6]),s[3]=_*(f[1]*p+f[4]*v+f[7]),_=1/(f[2]*p+f[5]*d+f[8]),s[4]=_*(f[0]*p+f[3]*d+f[6]),s[5]=_*(f[1]*p+f[4]*d+f[7]),_=1/(f[2]*y+f[5]*d+f[8]),s[6]=_*(f[0]*y+f[3]*d+f[6]),s[7]=_*(f[1]*y+f[4]*d+f[7])}}},{key:"toLocal",value:function(t,e,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:y.ALL;return E.call(this,t,e,r,i,n)}},{key:"worldTransform",get:function(){return this.proj.affine?this.transform.worldTransform:this.proj.world}}]),r}(k.a),Q=new m.m,J=function(t){c(r,t);var e=f(r);function r(t,i,n){var a;return Object(s.a)(this,r),(a=e.call(this,t,i,n)).tileProj=new B(a.tileTransform),a.tileProj.reverseLocalOrder=!0,a.proj=new B(a.transform),a.pluginName="tilingSprite2d",a.uvRespectAnchor=!0,a}return Object(o.a)(r,[{key:"worldTransform",get:function(){return this.proj.affine?this.transform.worldTransform:this.proj.world}},{key:"toLocal",value:function(t,e,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:y.ALL;return E.call(this,t,e,r,i,n)}},{key:"_render",value:function(t){var e=this._texture;e&&e.valid&&(this.tileTransform.updateTransform(Q),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))}}]),r}(g.a);function Y(){this.proj||(this.proj=new B(this.transform),this.toLocal=R.prototype.toLocal,Object.defineProperty(this,"worldTransform",{get:U,enumerable:!0,configurable:!0}))}x.b.prototype.convertTo2d=Y,k.a.prototype.convertTo2d=function(){this.proj||(this.calculateVertices=G.prototype.calculateVertices,this.calculateTrimmedVertices=G.prototype.calculateTrimmedVertices,this._calculateBounds=G.prototype._calculateBounds,this.pluginName="batch2d",Y.call(this))},x.b.prototype.convertSubtreeTo2d=function(){this.convertTo2d();for(var t=0;t<this.children.length;t++)this.children[t].convertSubtreeTo2d()},b.d.prototype.convertTo2d=b.f.prototype.convertTo2d=function(){this.proj||(this.calculateVertices=X.prototype.calculateVertices,this._renderDefault=X.prototype._renderDefault,"batch2d"!==this.material.pluginName&&(this.material=new T.d(this.material.texture,{program:v.L.from(X.defaultVertexShader,X.defaultFragmentShader),pluginName:"batch2d"})),Y.call(this))},g.a.prototype.convertTo2d=function(){this.proj||(this.tileProj=new B(this.tileTransform),this.tileProj.reverseLocalOrder=!0,this.uvRespectAnchor=!0,this.calculateTrimmedVertices=G.prototype.calculateTrimmedVertices,this._calculateBounds=G.prototype._calculateBounds,this._render=J.prototype._render,this.pluginName="tilingSprite2d",Y.call(this))};var W=function(t){c(r,t);var e=f(r);function r(t,i,n){var o;return Object(s.a)(this,r),o=e.call(this,t,i,n),r.prototype.__init.call(a(o)),o.proj=new B(o.transform),o.pluginName="batch2d",o}return Object(o.a)(r,[{key:"__init",value:function(){this.vertexData2d=null}},{key:"worldTransform",get:function(){return this.proj.affine?this.transform.worldTransform:this.proj.world}}]),r}(w.b);W.prototype.calculateVertices=G.prototype.calculateVertices,W.prototype.calculateTrimmedVertices=G.prototype.calculateTrimmedVertices,W.prototype._calculateBounds=G.prototype._calculateBounds;var H=new F,K=function(t){c(r,t);var e=f(r);function r(t){var i;return Object(s.a)(this,r),i=e.call(this,"\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec3 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\ngl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\nvTextureCoord = aTextureCoord;\nvMaskCoord = otherMatrix * vec3( aTextureCoord, 1.0);\n}\n","\nvarying vec3 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\nvec2 uv = vMaskCoord.xy / vMaskCoord.z;\n\nfloat clip = step(3.5,\n    step(maskClamp.x, uv.x) +\n    step(maskClamp.y, uv.y) +\n    step(uv.x, maskClamp.z) +\n    step(uv.y, maskClamp.w));\n\nvec4 original = texture2D(uSampler, vTextureCoord);\nvec4 masky = texture2D(mask, uv);\n\noriginal *= (masky.r * masky.a * alpha * clip);\n\ngl_FragColor = original;\n}\n"),r.prototype.__init.call(a(i)),t.renderable=!1,i.maskSprite=t,i}return Object(o.a)(r,[{key:"__init",value:function(){this.maskMatrix=new F}},{key:"apply",value:function(t,e,i,n){var a=this.maskSprite,o=this.maskSprite.texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new v.fb(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=a.texture,this.uniforms.otherMatrix=r.calculateSpriteMatrix(e,this.maskMatrix,a).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=a.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,t.applyFilter(this,e,i,n))}}],[{key:"calculateSpriteMatrix",value:function(t,e,r){var i=r.proj,n=t.filterFrame,a=i&&!i._affine?i.world.copyTo2dOr3d(H):H.copyFrom(r.transform.worldTransform),o=r.texture.orig;return e.set(t.width,0,0,t.height,n.x,n.y),a.invert(),e.setToMult(a,e),e.scaleAndTranslate(1/o.width,1/o.height,r.anchor.x,r.anchor.y),e}}]),r}(v.u);v.J.prototype.pushSpriteMask=function(t){var e=t.maskObject,r=t._target,i=this.alphaMaskPool[this.alphaMaskIndex];i||(i=this.alphaMaskPool[this.alphaMaskIndex]=[new K(e)]),i[0].resolution=this.renderer.resolution,i[0].maskSprite=e;var n=r.filterArea;r.filterArea=e.getBounds(!0),this.renderer.filter.push(r,i),r.filterArea=n,this.alphaMaskIndex++},v.S.registerPlugin("tilingSprite2d",z);var Z=function(t){c(r,t);var e=f(r);function r(t,i,n){var a;return Object(s.a)(this,r),(a=e.call(this,t,i)).z=n,a}return Object(o.a)(r,[{key:"set",value:function(t,e,r){return this.x=t||0,this.y=void 0===e?this.x:e||0,this.z=void 0===e?this.x:r||0,this}},{key:"copyFrom",value:function(t){return this.set(t.x,t.y,t.z||0),this}},{key:"copyTo",value:function(t){return t.set(this.x,this.y,this.z),t}}]),r}(m.g),$=function(t){c(r,t);var e=f(r);function r(){var t;Object(s.a)(this,r);for(var i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return t=e.call.apply(e,[this].concat(n)),r.prototype.__init.call(a(t)),t}return Object(o.a)(r,[{key:"__init",value:function(){this._z=0}},{key:"z",get:function(){return this._z},set:function(t){this._z!==t&&(this._z=t,this.cb.call(this.scope))}},{key:"set",value:function(t,e,r){var i=t||0,n=void 0===e?i:e||0,a=void 0===e?i:r||0;return this._x===i&&this._y===n&&this._z===a||(this._x=i,this._y=n,this._z=a,this.cb.call(this.scope)),this}},{key:"copyFrom",value:function(t){return this.set(t.x,t.y,t.z||0),this}},{key:"copyTo",value:function(t){return t.set(this._x,this._y,this._z),t}}]),r}(m.e),tt=function(){function t(e,r,i){Object(s.a)(this,t),t.prototype.__init.call(this),t.prototype.__init2.call(this),t.prototype.__init3.call(this),this._x=e||0,this._y=r||0,this._z=i||0,this.quaternion=new Float64Array(4),this.quaternion[3]=1,this.update()}return Object(o.a)(t,[{key:"__init",value:function(){this._quatUpdateId=-1}},{key:"__init2",value:function(){this._quatDirtyId=0}},{key:"__init3",value:function(){this._sign=1}},{key:"x",get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this._quatDirtyId++)}},{key:"y",get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this._quatDirtyId++)}},{key:"z",get:function(){return this._z},set:function(t){this._z!==t&&(this._z=t,this._quatDirtyId++)}},{key:"pitch",get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this._quatDirtyId++)}},{key:"yaw",get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this._quatDirtyId++)}},{key:"roll",get:function(){return this._z},set:function(t){this._z!==t&&(this._z=t,this._quatDirtyId++)}},{key:"set",value:function(t,e,r){var i=t||0,n=e||0,a=r||0;this._x===i&&this._y===n&&this._z===a||(this._x=i,this._y=n,this._z=a,this._quatDirtyId++)}},{key:"copyFrom",value:function(t){var e=t.x,r=t.y,i=t.z;return this._x===e&&this._y===r&&this._z===i||(this._x=e,this._y=r,this._z=i,this._quatDirtyId++),this}},{key:"copyTo",value:function(t){return t.set(this._x,this._y,this._z),t}},{key:"equals",value:function(t){return this._x===t.x&&this._y===t.y&&this._z===t.z}},{key:"clone",value:function(){return new t(this._x,this._y,this._z)}},{key:"update",value:function(){if(this._quatUpdateId===this._quatDirtyId)return!1;this._quatUpdateId=this._quatDirtyId;var t=Math.cos(this._x/2),e=Math.cos(this._y/2),r=Math.cos(this._z/2),i=this._sign,n=i*Math.sin(this._x/2),a=i*Math.sin(this._y/2),o=i*Math.sin(this._z/2),s=this.quaternion;return s[0]=n*e*r+t*a*o,s[1]=t*a*r-n*e*o,s[2]=t*e*o+n*a*r,s[3]=t*e*r-n*a*o,!0}}]),t}(),et=function(){function t(e,r,i,n,a){Object(s.a)(this,t),this.cb=e,this.scope=r,t.prototype.__init.call(this),t.prototype.__init2.call(this),t.prototype.__init3.call(this),this._x=i||0,this._y=n||0,this._z=a||0,this.quaternion=new Float64Array(4),this.quaternion[3]=1,this.update()}return Object(o.a)(t,[{key:"__init",value:function(){this._quatUpdateId=-1}},{key:"__init2",value:function(){this._quatDirtyId=0}},{key:"__init3",value:function(){this._sign=1}},{key:"x",get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this._quatDirtyId++,this.cb.call(this.scope))}},{key:"y",get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this._quatDirtyId++,this.cb.call(this.scope))}},{key:"z",get:function(){return this._z},set:function(t){this._z!==t&&(this._z=t,this._quatDirtyId++,this.cb.call(this.scope))}},{key:"pitch",get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this._quatDirtyId++,this.cb.call(this.scope))}},{key:"yaw",get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this._quatDirtyId++,this.cb.call(this.scope))}},{key:"roll",get:function(){return this._z},set:function(t){this._z!==t&&(this._z=t,this._quatDirtyId++,this.cb.call(this.scope))}},{key:"set",value:function(t,e,r){var i=t||0,n=e||0,a=r||0;return this._x===i&&this._y===n&&this._z===a||(this._x=i,this._y=n,this._z=a,this._quatDirtyId++,this.cb.call(this.scope)),this}},{key:"copyFrom",value:function(t){var e=t.x,r=t.y,i=t.z;return this._x===e&&this._y===r&&this._z===i||(this._x=e,this._y=r,this._z=i,this._quatDirtyId++,this.cb.call(this.scope)),this}},{key:"copyTo",value:function(t){return t.set(this._x,this._y,this._z),t}},{key:"equals",value:function(t){return this._x===t.x&&this._y===t.y&&this._z===t.z}},{key:"clone",value:function(){return new tt(this._x,this._y,this._z)}},{key:"update",value:function(){if(this._quatUpdateId===this._quatDirtyId)return!1;this._quatUpdateId=this._quatDirtyId;var t=Math.cos(this._x/2),e=Math.cos(this._y/2),r=Math.cos(this._z/2),i=this._sign,n=i*Math.sin(this._x/2),a=i*Math.sin(this._y/2),o=i*Math.sin(this._z/2),s=this.quaternion;return s[0]=n*e*r+t*a*o,s[1]=t*a*r-n*e*o,s[2]=t*e*o+n*a*r,s[3]=t*e*r-n*a*o,!0}}]),t}(),rt=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],it=function(){function t(e){Object(s.a)(this,t),t.prototype.__init.call(this),t.prototype.__init2.call(this),t.prototype.__init3.call(this),t.prototype.__init4.call(this),t.prototype.__init5.call(this),this.mat4=new Float64Array(e||rt)}return Object(o.a)(t,[{key:"__init",value:function(){this.floatArray=null}},{key:"__init2",value:function(){this._dirtyId=0}},{key:"__init3",value:function(){this._updateId=-1}},{key:"__init4",value:function(){this._mat4inv=null}},{key:"__init5",value:function(){this.cacheInverse=!1}},{key:"a",get:function(){return this.mat4[0]/this.mat4[15]},set:function(t){this.mat4[0]=t*this.mat4[15]}},{key:"b",get:function(){return this.mat4[1]/this.mat4[15]},set:function(t){this.mat4[1]=t*this.mat4[15]}},{key:"c",get:function(){return this.mat4[4]/this.mat4[15]},set:function(t){this.mat4[4]=t*this.mat4[15]}},{key:"d",get:function(){return this.mat4[5]/this.mat4[15]},set:function(t){this.mat4[5]=t*this.mat4[15]}},{key:"tx",get:function(){return this.mat4[12]/this.mat4[15]},set:function(t){this.mat4[12]=t*this.mat4[15]}},{key:"ty",get:function(){return this.mat4[13]/this.mat4[15]},set:function(t){this.mat4[13]=t*this.mat4[15]}},{key:"set",value:function(t,e,r,i,n,a){var o=this.mat4;return o[0]=t,o[1]=e,o[2]=0,o[3]=0,o[4]=r,o[5]=i,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=n,o[13]=a,o[14]=0,o[15]=1,this}},{key:"toArray",value:function(t,e){this.floatArray||(this.floatArray=new Float32Array(9));var r=e||this.floatArray,i=this.mat4;return t?(r[0]=i[0],r[1]=i[1],r[2]=i[3],r[3]=i[4],r[4]=i[5],r[5]=i[7],r[6]=i[12],r[7]=i[13],r[8]=i[15]):(r[0]=i[0],r[1]=i[4],r[2]=i[12],r[3]=i[2],r[4]=i[6],r[5]=i[13],r[6]=i[3],r[7]=i[7],r[8]=i[15]),r}},{key:"setToTranslation",value:function(t,e,r){var i=this.mat4;i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=t,i[13]=e,i[14]=r,i[15]=1}},{key:"setToRotationTranslationScale",value:function(t,e,r,i,n,a,o){var s=this.mat4,u=t[0],c=t[1],l=t[2],h=t[3],f=u+u,y=c+c,p=l+l,v=u*f,d=u*y,_=u*p,m=c*y,x=c*p,g=l*p,T=h*f,b=h*y,k=h*p;return s[0]=(1-(m+g))*n,s[1]=(d+k)*n,s[2]=(_-b)*n,s[3]=0,s[4]=(d-k)*a,s[5]=(1-(v+g))*a,s[6]=(x+T)*a,s[7]=0,s[8]=(_+b)*o,s[9]=(x-T)*o,s[10]=(1-(v+m))*o,s[11]=0,s[12]=e,s[13]=r,s[14]=i,s[15]=1,s}},{key:"apply",value:function(t,e){e=e||new Z;var r=this.mat4,i=t.x,n=t.y,a=t.z||0,o=1/(r[3]*i+r[7]*n+r[11]*a+r[15]);return e.x=o*(r[0]*i+r[4]*n+r[8]*a+r[12]),e.y=o*(r[1]*i+r[5]*n+r[9]*a+r[13]),e.z=o*(r[2]*i+r[6]*n+r[10]*a+r[14]),e}},{key:"translate",value:function(t,e,r){var i=this.mat4;return i[12]=i[0]*t+i[4]*e+i[8]*r+i[12],i[13]=i[1]*t+i[5]*e+i[9]*r+i[13],i[14]=i[2]*t+i[6]*e+i[10]*r+i[14],i[15]=i[3]*t+i[7]*e+i[11]*r+i[15],this}},{key:"scale",value:function(t,e,r){var i=this.mat4;return i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=t,i[4]*=e,i[5]*=e,i[6]*=e,i[7]*=e,void 0!==r&&(i[8]*=r,i[9]*=r,i[10]*=r,i[11]*=r),this}},{key:"scaleAndTranslate",value:function(t,e,r,i,n,a){var o=this.mat4;o[0]=t*o[0]+i*o[3],o[1]=e*o[1]+n*o[3],o[2]=r*o[2]+a*o[3],o[4]=t*o[4]+i*o[7],o[5]=e*o[5]+n*o[7],o[6]=r*o[6]+a*o[7],o[8]=t*o[8]+i*o[11],o[9]=e*o[9]+n*o[11],o[10]=r*o[10]+a*o[11],o[12]=t*o[12]+i*o[15],o[13]=e*o[13]+n*o[15],o[14]=r*o[14]+a*o[15]}},{key:"applyInverse",value:function(e,r){r=r||new Z,this._mat4inv||(this._mat4inv=new Float64Array(16));var i=this._mat4inv,n=this.mat4,a=e.x,o=e.y,s=e.z||0;this.cacheInverse&&this._updateId===this._dirtyId||(this._updateId=this._dirtyId,t.glMatrixMat4Invert(i,n));var u=1/(i[3]*a+i[7]*o+i[11]*s+i[15]),c=u*(i[0]*a+i[4]*o+i[8]*s+i[12]),l=u*(i[1]*a+i[5]*o+i[9]*s+i[13]),h=u*(i[2]*a+i[6]*o+i[10]*s+i[14]);s+=1;var f=1/(i[3]*a+i[7]*o+i[11]*s+i[15]),y=f*(i[0]*a+i[4]*o+i[8]*s+i[12]),p=f*(i[1]*a+i[5]*o+i[9]*s+i[13]),v=f*(i[2]*a+i[6]*o+i[10]*s+i[14]);Math.abs(h-v)<1e-10&&r.set(NaN,NaN,0);var d=(0-h)/(v-h);return r.set((y-c)*d+c,(p-l)*d+l,0),r}},{key:"invert",value:function(){return t.glMatrixMat4Invert(this.mat4,this.mat4),this}},{key:"invertCopyTo",value:function(e){this._mat4inv||(this._mat4inv=new Float64Array(16));var r=this._mat4inv,i=this.mat4;this.cacheInverse&&this._updateId===this._dirtyId||(this._updateId=this._dirtyId,t.glMatrixMat4Invert(r,i)),e.mat4.set(r)}},{key:"identity",value:function(){var t=this.mat4;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"clone",value:function(){return new t(this.mat4)}},{key:"copyTo3d",value:function(t){var e=this.mat4,r=t.mat4;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],t}},{key:"copyTo2d",value:function(t){var e=this.mat4,r=t.mat3;return r[0]=e[0],r[1]=e[1],r[2]=e[3],r[3]=e[4],r[4]=e[5],r[5]=e[7],r[6]=e[12],r[7]=e[13],r[8]=e[15],t}},{key:"copyTo2dOr3d",value:function(t){return t instanceof F?this.copyTo2d(t):this.copyTo3d(t)}},{key:"copyTo",value:function(t,e,r){var i=this.mat4,n=1/i[15],a=i[12]*n,o=i[13]*n;if(t.a=(i[0]-i[3]*a)*n,t.b=(i[1]-i[3]*o)*n,t.c=(i[4]-i[7]*a)*n,t.d=(i[5]-i[7]*o)*n,t.tx=a,t.ty=o,e>=2){var s=t.a*t.d-t.b*t.c;r||(s=Math.abs(s)),e===p.POINT?(s=s>0?1:-1,t.a=s,t.b=0,t.c=0,t.d=s):e===p.AXIS_X?(s/=Math.sqrt(t.b*t.b+t.d*t.d),t.c=0,t.d=s):e===p.AXIS_Y&&(s/=Math.sqrt(t.a*t.a+t.c*t.c),t.a=s,t.c=0)}return t}},{key:"copyFrom",value:function(t){var e=this.mat4;return e[0]=t.a,e[1]=t.b,e[2]=0,e[3]=0,e[4]=t.c,e[5]=t.d,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t.tx,e[13]=t.ty,e[14]=0,e[15]=1,this._dirtyId++,this}},{key:"setToMultLegacy",value:function(t,e){var r=this.mat4,i=e.mat4,n=t.a,a=t.b,o=t.c,s=t.d,u=t.tx,c=t.ty,l=i[0],h=i[1],f=i[2],y=i[3];return r[0]=l*n+h*o+y*u,r[1]=l*a+h*s+y*c,r[2]=f,r[3]=y,l=i[4],h=i[5],f=i[6],y=i[7],r[4]=l*n+h*o+y*u,r[5]=l*a+h*s+y*c,r[6]=f,r[7]=y,l=i[8],h=i[9],f=i[10],y=i[11],r[8]=l*n+h*o+y*u,r[9]=l*a+h*s+y*c,r[10]=f,r[11]=y,l=i[12],h=i[13],f=i[14],y=i[15],r[12]=l*n+h*o+y*u,r[13]=l*a+h*s+y*c,r[14]=f,r[15]=y,this._dirtyId++,this}},{key:"setToMultLegacy2",value:function(t,e){var r=this.mat4,i=t.mat4,n=i[0],a=i[1],o=i[2],s=i[3],u=i[4],c=i[5],l=i[6],h=i[7],f=e.a,y=e.b,p=e.c,v=e.d,d=e.tx,_=e.ty;return r[0]=f*n+y*u,r[1]=f*a+y*c,r[2]=f*o+y*l,r[3]=f*s+y*h,r[4]=p*n+v*u,r[5]=p*a+v*c,r[6]=p*o+v*l,r[7]=p*s+v*h,r[8]=i[8],r[9]=i[9],r[10]=i[10],r[11]=i[11],r[12]=d*n+_*u+i[12],r[13]=d*a+_*c+i[13],r[14]=d*o+_*l+i[14],r[15]=d*s+_*h+i[15],this._dirtyId++,this}},{key:"setToMult",value:function(e,r){return t.glMatrixMat4Multiply(this.mat4,e.mat4,r.mat4),this._dirtyId++,this}},{key:"prepend",value:function(t){t.mat4?this.setToMult(t,this):this.setToMultLegacy(t,this)}}],[{key:"__initStatic",value:function(){this.IDENTITY=new t}},{key:"__initStatic2",value:function(){this.TEMP_MATRIX=new t}},{key:"glMatrixMat4Invert",value:function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],c=e[7],l=e[8],h=e[9],f=e[10],y=e[11],p=e[12],v=e[13],d=e[14],_=e[15],m=r*s-i*o,x=r*u-n*o,g=r*c-a*o,T=i*u-n*s,b=i*c-a*s,k=n*c-a*u,w=l*v-h*p,j=l*d-f*p,I=l*_-y*p,D=h*d-f*v,M=h*_-y*v,O=f*_-y*d,C=m*O-x*M+g*D+T*I-b*j+k*w;return C?(C=1/C,t[0]=(s*O-u*M+c*D)*C,t[1]=(n*M-i*O-a*D)*C,t[2]=(v*k-d*b+_*T)*C,t[3]=(f*b-h*k-y*T)*C,t[4]=(u*I-o*O-c*j)*C,t[5]=(r*O-n*I+a*j)*C,t[6]=(d*g-p*k-_*x)*C,t[7]=(l*k-f*g+y*x)*C,t[8]=(o*M-s*I+c*w)*C,t[9]=(i*I-r*M-a*w)*C,t[10]=(p*b-v*g+_*m)*C,t[11]=(h*g-l*b-y*m)*C,t[12]=(s*j-o*D-u*w)*C,t[13]=(r*D-i*j+n*w)*C,t[14]=(v*x-p*T-d*m)*C,t[15]=(l*T-h*x+f*m)*C,t):null}},{key:"glMatrixMat4Multiply",value:function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],f=e[9],y=e[10],p=e[11],v=e[12],d=e[13],_=e[14],m=e[15],x=r[0],g=r[1],T=r[2],b=r[3];return t[0]=x*i+g*s+T*h+b*v,t[1]=x*n+g*u+T*f+b*d,t[2]=x*a+g*c+T*y+b*_,t[3]=x*o+g*l+T*p+b*m,x=r[4],g=r[5],T=r[6],b=r[7],t[4]=x*i+g*s+T*h+b*v,t[5]=x*n+g*u+T*f+b*d,t[6]=x*a+g*c+T*y+b*_,t[7]=x*o+g*l+T*p+b*m,x=r[8],g=r[9],T=r[10],b=r[11],t[8]=x*i+g*s+T*h+b*v,t[9]=x*n+g*u+T*f+b*d,t[10]=x*a+g*c+T*y+b*_,t[11]=x*o+g*l+T*p+b*m,x=r[12],g=r[13],T=r[14],b=r[15],t[12]=x*i+g*s+T*h+b*v,t[13]=x*n+g*u+T*f+b*d,t[14]=x*a+g*c+T*y+b*_,t[15]=x*o+g*l+T*p+b*m,t}}]),t}();it.__initStatic(),it.__initStatic2();var nt=new it,at=function(t){c(r,t);var e=f(r);function r(t,i){var n;return Object(s.a)(this,r),n=e.call(this,t,i),r.prototype.__init.call(a(n)),r.prototype.__init2.call(a(n)),r.prototype.__init3.call(a(n)),r.prototype.__init4.call(a(n)),r.prototype.__init5.call(a(n)),r.prototype.__init6.call(a(n)),n.local=new it,n.world=new it,n.local.cacheInverse=!0,n.world.cacheInverse=!0,n.position._z=0,n.scale._z=1,n.pivot._z=0,n}return Object(o.a)(r,[{key:"__init",value:function(){this.cameraMatrix=null}},{key:"__init2",value:function(){this._cameraMode=!1}},{key:"cameraMode",get:function(){return this._cameraMode},set:function(t){this._cameraMode!==t&&(this._cameraMode=t,this.euler._sign=this._cameraMode?-1:1,this.euler._quatDirtyId++,t&&(this.cameraMatrix=new it))}},{key:"__init3",value:function(){this.position=new $(this.onChange,this,0,0)}},{key:"__init4",value:function(){this.scale=new $(this.onChange,this,1,1)}},{key:"__init5",value:function(){this.euler=new et(this.onChange,this,0,0,0)}},{key:"__init6",value:function(){this.pivot=new $(this.onChange,this,0,0)}},{key:"onChange",value:function(){this._projID++}},{key:"clear",value:function(){this.cameraMatrix&&this.cameraMatrix.identity(),this.position.set(0,0,0),this.scale.set(1,1,1),this.euler.set(0,0,0),this.pivot.set(0,0,0),n(i(r.prototype),"clear",this).call(this)}},{key:"updateLocalTransform",value:function(t){if(0!==this._projID){var e=this.local,r=this.euler,i=this.position,n=this.scale,a=this.pivot;if(r.update(),!this.cameraMode)return e.setToRotationTranslationScale(r.quaternion,i._x,i._y,i._z,n._x,n._y,n._z),e.translate(-a._x,-a._y,-a._z),void e.setToMultLegacy(t,e);e.setToMultLegacy(t,this.cameraMatrix),e.translate(a._x,a._y,a._z),e.scale(1/n._x,1/n._y,1/n._z),nt.setToRotationTranslationScale(r.quaternion,0,0,0,1,1,1),e.setToMult(e,nt),e.translate(-i._x,-i._y,-i._z),this.local._dirtyId++}else this.local.copyFrom(t)}}]),r}(O);var ot=function(t){c(r,t);var e=f(r);function r(){var t;return Object(s.a)(this,r),(t=e.call(this)).proj=new at(t.transform),t}return Object(o.a)(r,[{key:"isFrontFace",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t&&(this._recursivePostUpdateTransform(),this.displayObjectUpdateTransform());var e=this.proj.world.mat4,r=e[0]*e[15]-e[3]*e[12],i=e[1]*e[15]-e[3]*e[13],n=e[4]*e[15]-e[7]*e[12],a=e[5]*e[15]-e[7]*e[13];return r*a-n*i>0}},{key:"getDepth",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t&&(this._recursivePostUpdateTransform(),this.displayObjectUpdateTransform());var e=this.proj.world.mat4;return e[14]/e[15]}},{key:"toLocal",value:function(t,e,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:y.ALL;return e&&(t=e.toGlobal(t,r,i)),i||this._recursivePostUpdateTransform(),n===y.ALL?(i||this.displayObjectUpdateTransform(),this.proj.affine?this.transform.worldTransform.applyInverse(t,r):this.proj.world.applyInverse(t,r)):(this.parent?r=this.parent.worldTransform.applyInverse(t,r):(r.x=t.x,r.y=t.y,r.z=t.z),n===y.NONE||(r=this.transform.localTransform.applyInverse(r,r),n===y.PROJ&&this.proj.cameraMode&&(r=this.proj.cameraMatrix.applyInverse(r,r))),r)}},{key:"worldTransform",get:function(){return this.proj.affine?this.transform.worldTransform:this.proj.world}},{key:"position3d",get:function(){return this.proj.position},set:function(t){this.proj.position.copyFrom(t)}},{key:"scale3d",get:function(){return this.proj.scale},set:function(t){this.proj.scale.copyFrom(t)}},{key:"euler",get:function(){return this.proj.euler},set:function(t){this.proj.euler.copyFrom(t)}},{key:"pivot3d",get:function(){return this.proj.pivot},set:function(t){this.proj.pivot.copyFrom(t)}}]),r}(x.b),st=ot.prototype.toLocal,ut=ot.prototype.getDepth,ct=ot.prototype.isFrontFace,lt=function(t){c(r,t);var e=f(r);function r(){var t;return Object(s.a)(this,r),t=e.call(this),r.prototype.__init.call(a(t)),r.prototype.__init2.call(a(t)),r.prototype.__init3.call(a(t)),r.prototype.__init4.call(a(t)),t.proj.cameraMode=!0,t.setPlanes(400,10,1e4,!1),t}return Object(o.a)(r,[{key:"__init",value:function(){this._far=0}},{key:"__init2",value:function(){this._near=0}},{key:"__init3",value:function(){this._focus=0}},{key:"__init4",value:function(){this._orthographic=!1}},{key:"far",get:function(){return this._far}},{key:"near",get:function(){return this._near}},{key:"focus",get:function(){return this._focus}},{key:"ortographic",get:function(){return this._orthographic}},{key:"setPlanes",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._focus=t,this._near=e,this._far=r,this._orthographic=i;var n=this.proj,a=n.cameraMatrix.mat4;n._projID++,a[10]=1/(r-e),a[14]=(t-e)/(r-e),this._orthographic?a[11]=0:a[11]=1/t}}]),r}(ot),ht=function(t){c(r,t);var e=f(r);function r(t,i,n,o){var u;return Object(s.a)(this,r),u=e.call(this,t,i,n,o),r.prototype.__init.call(a(u)),u.proj=new at(u.transform),u}return Object(o.a)(r,[{key:"__init",value:function(){this.vertexData2d=null}},{key:"calculateVertices",value:function(){if(this.proj._affine)return this.vertexData2d=null,void n(i(r.prototype),"calculateVertices",this).call(this);var t=this.geometry,e=t.buffers[0].data,a=this;if(t.vertexDirtyId!==a.vertexDirty||a._transformID!==a.transform._worldID){a._transformID=a.transform._worldID,a.vertexData.length!==e.length&&(a.vertexData=new Float32Array(e.length)),this.vertexData2d&&this.vertexData2d.length===3*e.length/2||(this.vertexData2d=new Float32Array(3*e.length));for(var o=this.proj.world.mat4,s=this.vertexData2d,u=a.vertexData,c=0;c<u.length/2;c++){var l=e[2*c],h=e[2*c+1],f=o[0]*l+o[4]*h+o[12],y=o[1]*l+o[5]*h+o[13],p=o[3]*l+o[7]*h+o[15];s[3*c]=f,s[3*c+1]=y,s[3*c+2]=p,u[2*c]=f/p,u[2*c+1]=y/p}a.vertexDirty=t.vertexDirtyId}}},{key:"worldTransform",get:function(){return this.proj.affine?this.transform.worldTransform:this.proj.world}},{key:"toLocal",value:function(t,e,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:y.ALL;return st.call(this,t,e,r,i,n)}},{key:"isFrontFace",value:function(t){return ct.call(this,t)}},{key:"getDepth",value:function(t){return ut.call(this,t)}},{key:"position3d",get:function(){return this.proj.position},set:function(t){this.proj.position.copyFrom(t)}},{key:"scale3d",get:function(){return this.proj.scale},set:function(t){this.proj.scale.copyFrom(t)}},{key:"euler",get:function(){return this.proj.euler},set:function(t){this.proj.euler.copyFrom(t)}},{key:"pivot3d",get:function(){return this.proj.pivot},set:function(t){this.proj.pivot.copyFrom(t)}}]),r}(T.a);ht.prototype._renderDefault=X.prototype._renderDefault;var ft=function(t){c(r,t);var e=f(r);function r(t){var i;return Object(s.a)(this,r),i=e.call(this,t),r.prototype.__init.call(a(i)),r.prototype.__init2.call(a(i)),r.prototype.__init3.call(a(i)),i.proj=new at(i.transform),i.pluginName="batch2d",i}return Object(o.a)(r,[{key:"__init",value:function(){this.vertexData2d=null}},{key:"__init2",value:function(){this.culledByFrustrum=!1}},{key:"__init3",value:function(){this.trimmedCulledByFrustrum=!1}},{key:"calculateVertices",value:function(){var t=this._texture;if(this.proj._affine)return this.vertexData2d=null,void n(i(r.prototype),"calculateVertices",this).call(this);this.vertexData2d||(this.vertexData2d=new Float32Array(12));var e=this.transform._worldID,a=t._updateID;if(this._transformID!==e||this._textureID!==a){this._textureID!==a&&(this.uvs=t._uvs.uvsFloat32),this._transformID=e,this._textureID=a;var o,s,u,c,l=this.proj.world.mat4,h=this.vertexData2d,f=this.vertexData,y=t.trim,p=t.orig,v=this._anchor;y?(o=(s=y.x-v._x*p.width)+y.width,u=(c=y.y-v._y*p.height)+y.height):(o=(s=-v._x*p.width)+p.width,u=(c=-v._y*p.height)+p.height);var d,_=!1;h[0]=l[0]*s+l[4]*c+l[12],h[1]=l[1]*s+l[5]*c+l[13],d=l[2]*s+l[6]*c+l[14],h[2]=l[3]*s+l[7]*c+l[15],_=_||d<0,h[3]=l[0]*o+l[4]*c+l[12],h[4]=l[1]*o+l[5]*c+l[13],d=l[2]*o+l[6]*c+l[14],h[5]=l[3]*o+l[7]*c+l[15],_=_||d<0,h[6]=l[0]*o+l[4]*u+l[12],h[7]=l[1]*o+l[5]*u+l[13],d=l[2]*o+l[6]*u+l[14],h[8]=l[3]*o+l[7]*u+l[15],_=_||d<0,h[9]=l[0]*s+l[4]*u+l[12],h[10]=l[1]*s+l[5]*u+l[13],d=l[2]*s+l[6]*u+l[14],h[11]=l[3]*s+l[7]*u+l[15],_=_||d<0,this.culledByFrustrum=_,f[0]=h[0]/h[2],f[1]=h[1]/h[2],f[2]=h[3]/h[5],f[3]=h[4]/h[5],f[4]=h[6]/h[8],f[5]=h[7]/h[8],f[6]=h[9]/h[11],f[7]=h[10]/h[11]}}},{key:"calculateTrimmedVertices",value:function(){if(this.proj._affine)n(i(r.prototype),"calculateTrimmedVertices",this).call(this);else{var t=this.transform._worldID,e=this._texture._updateID,a=this;if(a.vertexTrimmedData){if(a._transformTrimmedID===t&&this._textureTrimmedID===e)return}else a.vertexTrimmedData=new Float32Array(8);a._transformTrimmedID=t,this._textureTrimmedID=e;var o,s=this._texture,u=a.vertexTrimmedData,c=s.orig,l=this._anchor,h=this.proj.world.mat4,f=-l._x*c.width,y=f+c.width,p=-l._y*c.height,v=p+c.height,d=!1,_=1/(h[3]*f+h[7]*p+h[15]);u[0]=_*(h[0]*f+h[4]*p+h[12]),u[1]=_*(h[1]*f+h[5]*p+h[13]),o=h[2]*f+h[6]*p+h[14],d=d||o<0,_=1/(h[3]*y+h[7]*p+h[15]),u[2]=_*(h[0]*y+h[4]*p+h[12]),u[3]=_*(h[1]*y+h[5]*p+h[13]),o=h[2]*y+h[6]*p+h[14],d=d||o<0,_=1/(h[3]*y+h[7]*v+h[15]),u[4]=_*(h[0]*y+h[4]*v+h[12]),u[5]=_*(h[1]*y+h[5]*v+h[13]),o=h[2]*y+h[6]*v+h[14],d=d||o<0,_=1/(h[3]*f+h[7]*v+h[15]),u[6]=_*(h[0]*f+h[4]*v+h[12]),u[7]=_*(h[1]*f+h[5]*v+h[13]),o=h[2]*f+h[6]*v+h[14],d=d||o<0,this.culledByFrustrum=d}}},{key:"_calculateBounds",value:function(){if(this.calculateVertices(),!this.culledByFrustrum){var t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?this._bounds.addQuad(this.vertexData):(this.calculateTrimmedVertices(),this.trimmedCulledByFrustrum||this._bounds.addQuad(this.vertexTrimmedData))}}},{key:"_render",value:function(t){this.calculateVertices(),this.culledByFrustrum||(t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))}},{key:"containsPoint",value:function(t){return!this.culledByFrustrum&&n(i(r.prototype),"containsPoint",this).call(this,t)}},{key:"worldTransform",get:function(){return this.proj.affine?this.transform.worldTransform:this.proj.world}},{key:"toLocal",value:function(t,e,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:y.ALL;return st.call(this,t,e,r,i,n)}},{key:"isFrontFace",value:function(t){return ct.call(this,t)}},{key:"getDepth",value:function(t){return ut.call(this,t)}},{key:"position3d",get:function(){return this.proj.position},set:function(t){this.proj.position.copyFrom(t)}},{key:"scale3d",get:function(){return this.proj.scale},set:function(t){this.proj.scale.copyFrom(t)}},{key:"euler",get:function(){return this.proj.euler},set:function(t){this.proj.euler.copyFrom(t)}},{key:"pivot3d",get:function(){return this.proj.pivot},set:function(t){this.proj.pivot.copyFrom(t)}}]),r}(k.a),yt={worldTransform:{get:function(){return this.proj.affine?this.transform.worldTransform:this.proj.world},enumerable:!0,configurable:!0},position3d:{get:function(){return this.proj.position},set:function(t){this.proj.position.copy(t)}},scale3d:{get:function(){return this.proj.scale},set:function(t){this.proj.scale.copy(t)}},pivot3d:{get:function(){return this.proj.pivot},set:function(t){this.proj.pivot.copy(t)}},euler:{get:function(){return this.proj.euler},set:function(t){this.proj.euler.copy(t)}}};function pt(){this.proj||(this.proj=new at(this.transform),this.toLocal=ot.prototype.toLocal,this.isFrontFace=ot.prototype.isFrontFace,this.getDepth=ot.prototype.getDepth,Object.defineProperties(this,yt))}x.b.prototype.convertTo3d=pt,k.a.prototype.convertTo3d=function(){this.proj||(this.calculateVertices=ft.prototype.calculateVertices,this.calculateTrimmedVertices=ft.prototype.calculateTrimmedVertices,this._calculateBounds=ft.prototype._calculateBounds,this.containsPoint=ft.prototype.containsPoint,this.pluginName="batch2d",pt.call(this))},x.b.prototype.convertSubtreeTo3d=function(){this.convertTo3d();for(var t=0;t<this.children.length;t++)this.children[t].convertSubtreeTo3d()},b.d.prototype.convertTo3d=b.f.prototype.convertTo3d=function(){this.proj||(this.calculateVertices=ht.prototype.calculateVertices,this._renderDefault=ht.prototype._renderDefault,"batch2d"!==this.material.pluginName&&(this.material=new T.d(this.material.texture,{program:v.L.from(X.defaultVertexShader,X.defaultFragmentShader),pluginName:"batch2d"})),pt.call(this))};var vt,dt=function(t){c(r,t);var e=f(r);function r(t,i,n){var o;return Object(s.a)(this,r),o=e.call(this,t,i,n),r.prototype.__init.call(a(o)),o.proj=new at(o.transform),o.pluginName="batch2d",o}return Object(o.a)(r,[{key:"__init",value:function(){this.vertexData2d=null}},{key:"worldTransform",get:function(){return this.proj.affine?this.transform.worldTransform:this.proj.world}},{key:"toLocal",value:function(t,e,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:y.ALL;return st.call(this,t,e,r,i,n)}},{key:"isFrontFace",value:function(t){return ct.call(this,t)}},{key:"getDepth",value:function(t){return ut.call(this,t)}},{key:"position3d",get:function(){return this.proj.position},set:function(t){this.proj.position.copyFrom(t)}},{key:"scale3d",get:function(){return this.proj.scale},set:function(t){this.proj.scale.copyFrom(t)}},{key:"euler",get:function(){return this.proj.euler},set:function(t){this.proj.euler.copyFrom(t)}},{key:"pivot3d",get:function(){return this.proj.pivot},set:function(t){this.proj.pivot.copyFrom(t)}}]),r}(w.b);dt.prototype.calculateVertices=ft.prototype.calculateVertices,dt.prototype.calculateTrimmedVertices=ft.prototype.calculateTrimmedVertices,dt.prototype._calculateBounds=ft.prototype._calculateBounds,dt.prototype.containsPoint=ft.prototype.containsPoint,dt.prototype._render=ft.prototype._render;var _t=function(t){c(r,t);var e=f(r);function r(){var t,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Object(s.a)(this,r),(t=e.call(this))._buffer=new v.p(null,i,!1),t._indexBuffer=new v.p(null,i,!0),t.addAttribute("aVertexPosition",t._buffer,2,!1,d.r.FLOAT).addAttribute("aTrans1",t._buffer,3,!1,d.r.FLOAT).addAttribute("aTrans2",t._buffer,3,!1,d.r.FLOAT).addAttribute("aSamplerSize",t._buffer,2,!1,d.r.FLOAT).addAttribute("aFrame",t._buffer,4,!1,d.r.FLOAT).addAttribute("aColor",t._buffer,4,!0,d.r.UNSIGNED_BYTE).addAttribute("aTextureId",t._buffer,1,!0,d.r.FLOAT).addIndex(t._indexBuffer),t}return r}(v.C),mt=function(){function t(){Object(s.a)(this,t)}return Object(o.a)(t,null,[{key:"create",value:function(t){var e=Object.assign({vertex:"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec3 aTrans1;\nattribute vec3 aTrans2;\nattribute vec2 aSamplerSize;\nattribute vec4 aFrame;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\n\nvarying vec2 vertexPosition;\nvarying vec3 vTrans1;\nvarying vec3 vTrans2;\nvarying vec2 vSamplerSize;\nvarying vec4 vFrame;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\ngl_Position.xyw = projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0);\ngl_Position.z = 0.0;\n\nvertexPosition = aVertexPosition;\nvTrans1 = aTrans1;\nvTrans2 = aTrans2;\nvTextureId = aTextureId;\nvColor = aColor;\nvSamplerSize = aSamplerSize;\nvFrame = aFrame;\n}\n",fragment:"precision highp float;\nvarying vec2 vertexPosition;\nvarying vec3 vTrans1;\nvarying vec3 vTrans2;\nvarying vec2 vSamplerSize;\nvarying vec4 vFrame;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nuniform sampler2D uSamplers[%count%];\nuniform vec4 distortion;\n\nvoid main(void){\nvec2 surface;\nvec2 surface2;\n\nfloat vx = vertexPosition.x;\nfloat vy = vertexPosition.y;\nfloat dx = distortion.x;\nfloat dy = distortion.y;\nfloat revx = distortion.z;\nfloat revy = distortion.w;\n\nif (distortion.x == 0.0) {\nsurface.x = vx;\nsurface.y = vy / (1.0 + dy * vx);\nsurface2 = surface;\n} else\nif (distortion.y == 0.0) {\nsurface.y = vy;\nsurface.x = vx / (1.0 + dx * vy);\nsurface2 = surface;\n} else {\nfloat c = vy * dx - vx * dy;\nfloat b = (c + 1.0) * 0.5;\nfloat b2 = (-c + 1.0) * 0.5;\nfloat d = b * b + vx * dy;\nif (d < -0.00001) {\n    discard;\n}\nd = sqrt(max(d, 0.0));\nsurface.x = (- b + d) * revy;\nsurface2.x = (- b - d) * revy;\nsurface.y = (- b2 + d) * revx;\nsurface2.y = (- b2 - d) * revx;\n}\n\nvec2 uv;\nuv.x = vTrans1.x * surface.x + vTrans1.y * surface.y + vTrans1.z;\nuv.y = vTrans2.x * surface.x + vTrans2.y * surface.y + vTrans2.z;\n\nvec2 pixels = uv * vSamplerSize;\n\nif (pixels.x < vFrame.x || pixels.x > vFrame.z ||\npixels.y < vFrame.y || pixels.y > vFrame.w) {\nuv.x = vTrans1.x * surface2.x + vTrans1.y * surface2.y + vTrans1.z;\nuv.y = vTrans2.x * surface2.x + vTrans2.y * surface2.y + vTrans2.z;\npixels = uv * vSamplerSize;\n\nif (pixels.x < vFrame.x || pixels.x > vFrame.z ||\n   pixels.y < vFrame.y || pixels.y > vFrame.w) {\n   discard;\n}\n}\n\nvec4 edge;\nedge.xy = clamp(pixels - vFrame.xy + 0.5, vec2(0.0, 0.0), vec2(1.0, 1.0));\nedge.zw = clamp(vFrame.zw - pixels + 0.5, vec2(0.0, 0.0), vec2(1.0, 1.0));\n\nfloat alpha = 1.0; //edge.x * edge.y * edge.z * edge.w;\nvec4 rColor = vColor * alpha;\n\nfloat textureId = floor(vTextureId+0.5);\nvec2 vTextureCoord = uv;\nvec4 color;\n%forloop%\ngl_FragColor = color * rColor;\n}",geometryClass:_t,vertexSize:16},t),r=e.vertex,i=e.fragment,n=e.vertexSize,u=e.geometryClass;return vt=function(t){c(l,t);var e=f(l);function l(t){var o;return Object(s.a)(this,l),o=e.call(this,t),vt.prototype.__init.call(a(o)),vt.prototype.__init2.call(a(o)),vt.prototype.__init3.call(a(o)),o.shaderGenerator=new v.m(r,i),o.geometryClass=u,o.vertexSize=n,o}return Object(o.a)(l,[{key:"__init",value:function(){this.defUniforms={translationMatrix:new m.d,distortion:new Float32Array([0,0,1/0,1/0])}}},{key:"__init2",value:function(){this.size=1e3}},{key:"__init3",value:function(){this.forceMaxTextures=1}},{key:"getUniforms",value:function(t){var e=t.proj;return null!==e.surface?e.uniforms:null!==e._activeProjection?e._activeProjection.uniforms:this.defUniforms}},{key:"packInterleavedGeometry",value:function(t,e,r,i,n){for(var a=e.uint32View,o=e.float32View,s=i/this.vertexSize,u=t.indices,c=t.vertexData,l=t._texture._frame,h=t.aTrans,f=t._texture.baseTexture,y=f._batchLocation,p=f.realWidth,v=f.realHeight,d=f.resolution,m=Math.min(t.worldAlpha,1),x=m<1&&t._texture.baseTexture.alphaMode?Object(_.premultiplyTint)(t._tintRGB,m):t._tintRGB+(255*m<<24),g=0;g<c.length;g+=2)o[i]=c[g],o[i+1]=c[g+1],o[i+2]=h.a,o[i+3]=h.c,o[i+4]=h.tx,o[i+5]=h.b,o[i+6]=h.d,o[i+7]=h.ty,o[i+8]=p,o[i+9]=v,o[i+10]=l.x*d,o[i+11]=l.y*d,o[i+12]=(l.x+l.width)*d,o[i+13]=(l.y+l.height)*d,a[i+14]=x,o[i+15]=y,i+=16;for(var T=0;T<u.length;T++)r[n++]=s+u[T]}}]),l}(C)}}]),t}(),xt=[new m.g,new m.g,new m.g,new m.g],gt=[0,0,0,0],Tt=function(){function t(){Object(s.a)(this,t),t.prototype.__init.call(this),t.prototype.__init2.call(this),t.prototype.__init3.call(this),t.prototype.__init4.call(this)}return Object(o.a)(t,[{key:"__init",value:function(){this.surfaceID="default"}},{key:"__init2",value:function(){this._updateID=0}},{key:"__init3",value:function(){this.vertexSrc=""}},{key:"__init4",value:function(){this.fragmentSrc=""}},{key:"fillUniforms",value:function(t){}},{key:"clear",value:function(){}},{key:"boundsQuad",value:function(t,e,r){for(var i=e[0],n=e[1],a=e[0],o=e[1],s=2;s<8;s+=2)i>e[s]&&(i=e[s]),a<e[s]&&(a=e[s]),n>e[s+1]&&(n=e[s+1]),o<e[s+1]&&(o=e[s+1]);if(xt[0].set(i,n),this.apply(xt[0],xt[0]),xt[1].set(a,n),this.apply(xt[1],xt[1]),xt[2].set(a,o),this.apply(xt[2],xt[2]),xt[3].set(i,o),this.apply(xt[3],xt[3]),r)r.apply(xt[0],xt[0]),r.apply(xt[1],xt[1]),r.apply(xt[2],xt[2]),r.apply(xt[3],xt[3]),e[0]=xt[0].x,e[1]=xt[0].y,e[2]=xt[1].x,e[3]=xt[1].y,e[4]=xt[2].x,e[5]=xt[2].y,e[6]=xt[3].x,e[7]=xt[3].y;else{for(var u=1;u<=3;u++)if(xt[u].y<xt[0].y||xt[u].y===xt[0].y&&xt[u].x<xt[0].x){var c=xt[0];xt[0]=xt[u],xt[u]=c}for(var l=1;l<=3;l++)gt[l]=Math.atan2(xt[l].y-xt[0].y,xt[l].x-xt[0].x);for(var h=1;h<=3;h++)for(var f=h+1;f<=3;f++)if(gt[h]>gt[f]){var y=xt[h];xt[h]=xt[f],xt[f]=y;var p=gt[h];gt[h]=gt[f],gt[f]=p}if(e[0]=xt[0].x,e[1]=xt[0].y,e[2]=xt[1].x,e[3]=xt[1].y,e[4]=xt[2].x,e[5]=xt[2].y,e[6]=xt[3].x,e[7]=xt[3].y,(xt[3].x-xt[2].x)*(xt[1].y-xt[2].y)-(xt[1].x-xt[2].x)*(xt[3].y-xt[2].y)<0)return e[4]=xt[3].x,void(e[5]=xt[3].y)}}}]),t}(),bt=new m.d,kt=new m.j,wt=new m.g,jt=function(t){c(r,t);var e=f(r);function r(){var t;Object(s.a)(this,r);for(var i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return t=e.call.apply(e,[this].concat(n)),r.prototype.__init.call(a(t)),t}return Object(o.a)(r,[{key:"__init",value:function(){this.distortion=new m.g}},{key:"clear",value:function(){this.distortion.set(0,0)}},{key:"apply",value:function(t,e){e=e||new m.g;var r=this.distortion,i=t.x*t.y;return e.x=t.x+r.x*i,e.y=t.y+r.y*i,e}},{key:"applyInverse",value:function(t,e){e=e||new m.g;var r=t.x,i=t.y,n=this.distortion.x,a=this.distortion.y;if(0===n)e.x=r,e.y=i/(1+a*r);else if(0===a)e.y=i,e.x=r/(1+n*i);else{var o=.5*(i*n-r*a+1)/a,s=o*o+r/a;if(s<=1e-5)return e.set(NaN,NaN),e;e.x=a>0?-o+Math.sqrt(s):-o-Math.sqrt(s),e.y=(r/e.x-1)/n}return e}},{key:"mapSprite",value:function(t,e,r){var i=t.texture;return kt.x=-t.anchor.x*i.orig.width,kt.y=-t.anchor.y*i.orig.height,kt.width=i.orig.width,kt.height=i.orig.height,this.mapQuad(kt,e,r||t.transform)}},{key:"mapQuad",value:function(t,e,r){var i=-t.x/t.width,n=-t.y/t.height,a=(1-t.x)/t.width,o=(1-t.y)/t.height,s=e[0].x*(1-i)+e[1].x*i,u=e[0].y*(1-i)+e[1].y*i,c=e[0].x*(1-a)+e[1].x*a,l=e[0].y*(1-a)+e[1].y*a,h=e[3].x*(1-i)+e[2].x*i,f=e[3].y*(1-i)+e[2].y*i,y=e[3].x*(1-a)+e[2].x*a,p=e[3].y*(1-a)+e[2].y*a,v=s*(1-n)+h*n,d=u*(1-n)+f*n,_=c*(1-n)+y*n,m=l*(1-n)+p*n,x=s*(1-o)+h*o,g=u*(1-o)+f*o,T=c*(1-o)+y*o,b=l*(1-o)+p*o,k=bt;return k.tx=v,k.ty=d,k.a=_-v,k.b=m-d,k.c=x-v,k.d=g-d,wt.set(T,b),k.applyInverse(wt,wt),this.distortion.set(wt.x-1,wt.y-1),r.setFromMatrix(k),this}},{key:"fillUniforms",value:function(t){t.distortion=t.distortion||new Float32Array([0,0,0,0]);var e=Math.abs(this.distortion.x),r=Math.abs(this.distortion.y);t.distortion[0]=1e4*e<=r?0:this.distortion.x,t.distortion[1]=1e4*r<=e?0:this.distortion.y,t.distortion[2]=1/t.distortion[0],t.distortion[3]=1/t.distortion[1]}}]),r}(Tt),It=m.m.prototype.updateTransform;function Dt(t){var e=this.proj,r=t.proj;return r?r._surface?(e._activeProjection=r,this.updateLocalTransform(),this.localTransform.copyTo(this.worldTransform),void(this._parentID<0&&++this._worldID)):(It.call(this,t),void(e._activeProjection=r._activeProjection)):(It.call(this,t),void(e._activeProjection=null))}var Mt=function(t){c(r,t);var e=f(r);function r(){var t;Object(s.a)(this,r);for(var i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return t=e.call.apply(e,[this].concat(n)),r.prototype.__init.call(a(t)),r.prototype.__init2.call(a(t)),r.prototype.__init3.call(a(t)),r.prototype.__init4.call(a(t)),r.prototype.__init5.call(a(t)),t}return Object(o.a)(r,[{key:"__init",value:function(){this._surface=null}},{key:"__init2",value:function(){this._activeProjection=null}},{key:"enabled",set:function(t){t!==this._enabled&&(this._enabled=t,t?(this.legacy.updateTransform=Dt,this.legacy._parentID=-1):(this.legacy.updateTransform=m.m.prototype.updateTransform,this.legacy._parentID=-1))}},{key:"surface",get:function(){return this._surface},set:function(t){this._surface!==t&&(this._surface=t||null,this.legacy._parentID=-1)}},{key:"applyPartial",value:function(t,e){return null!==this._activeProjection?(e=this.legacy.worldTransform.apply(t,e),this._activeProjection.surface.apply(e,e)):null!==this._surface?this.surface.apply(t,e):this.legacy.worldTransform.apply(t,e)}},{key:"apply",value:function(t,e){return null!==this._activeProjection?(e=this.legacy.worldTransform.apply(t,e),this._activeProjection.surface.apply(e,e),this._activeProjection.legacy.worldTransform.apply(e,e)):null!==this._surface?(e=this.surface.apply(t,e),this.legacy.worldTransform.apply(e,e)):this.legacy.worldTransform.apply(t,e)}},{key:"applyInverse",value:function(t,e){return null!==this._activeProjection?(e=this._activeProjection.legacy.worldTransform.applyInverse(t,e),this._activeProjection._surface.applyInverse(e,e),this.legacy.worldTransform.applyInverse(e,e)):null!==this._surface?(e=this.legacy.worldTransform.applyInverse(t,e),this._surface.applyInverse(e,e)):this.legacy.worldTransform.applyInverse(t,e)}},{key:"mapBilinearSprite",value:function(t,e){this._surface instanceof jt||(this.surface=new jt),this.surface.mapSprite(t,e,this.legacy)}},{key:"__init3",value:function(){this._currentSurfaceID=-1}},{key:"__init4",value:function(){this._currentLegacyID=-1}},{key:"__init5",value:function(){this._lastUniforms=null}},{key:"clear",value:function(){this.surface&&this.surface.clear()}},{key:"uniforms",get:function(){return this._currentLegacyID===this.legacy._worldID&&this._currentSurfaceID===this.surface._updateID||(this._lastUniforms=this._lastUniforms||{},this._lastUniforms.translationMatrix=this.legacy.worldTransform,this._surface.fillUniforms(this._lastUniforms)),this._lastUniforms}}]),r}(D),Ot=function(t){c(r,t);var e=f(r);function r(t){var i;return Object(s.a)(this,r),i=e.call(this,t),r.prototype.__init.call(a(i)),i.proj=new Mt(i.transform),i.pluginName="batch_bilinear",i}return Object(o.a)(r,[{key:"__init",value:function(){this.aTrans=new m.d}},{key:"_calculateBounds",value:function(){this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData)}},{key:"calculateVertices",value:function(){var t=this.transform._worldID,e=this._texture._updateID;if(this._transformID!==t||this._textureID!==e){this._transformID=t,this._textureID=e;var r,i,n,a,o=this._texture,s=this.vertexData,u=o.trim,c=o.orig,l=this._anchor;if(u?(r=(i=u.x-l._x*c.width)+u.width,n=(a=u.y-l._y*c.height)+u.height):(r=(i=-l._x*c.width)+c.width,n=(a=-l._y*c.height)+c.height),this.proj._surface)s[0]=i,s[1]=a,s[2]=r,s[3]=a,s[4]=r,s[5]=n,s[6]=i,s[7]=n,this.proj._surface.boundsQuad(s,s);else{var h=this.transform.worldTransform,f=h.a,y=h.b,p=h.c,d=h.d,_=h.tx,m=h.ty;s[0]=f*i+p*a+_,s[1]=d*a+y*i+m,s[2]=f*r+p*a+_,s[3]=d*a+y*r+m,s[4]=f*r+p*n+_,s[5]=d*n+y*r+m,s[6]=f*i+p*n+_,s[7]=d*n+y*i+m,this.proj._activeProjection&&this.proj._activeProjection.surface.boundsQuad(s,s)}o.uvMatrix||(o.uvMatrix=new v.fb(o)),o.uvMatrix.update();var x=this.aTrans;x.set(c.width,0,0,c.height,i,a),null===this.proj._surface&&x.prepend(this.transform.worldTransform),x.invert(),x.prepend(o.uvMatrix.mapCoord)}}},{key:"calculateTrimmedVertices",value:function(){var t=this.transform._worldID,e=this._texture._updateID,r=this;if(r.vertexTrimmedData){if(r._transformTrimmedID===t&&this._textureTrimmedID===e)return}else r.vertexTrimmedData=new Float32Array(8);r._transformTrimmedID=t,this._textureTrimmedID=e;var i=this._texture,n=r.vertexTrimmedData,a=i.orig,o=this._anchor,s=-o._x*a.width,u=s+a.width,c=-o._y*a.height,l=c+a.height;if(this.proj._surface)n[0]=s,n[1]=c,n[2]=u,n[3]=c,n[4]=u,n[5]=l,n[6]=s,n[7]=l,this.proj._surface.boundsQuad(n,n,this.transform.worldTransform);else{var h=this.transform.worldTransform,f=h.a,y=h.b,p=h.c,v=h.d,d=h.tx,_=h.ty;n[0]=f*s+p*c+d,n[1]=v*c+y*s+_,n[2]=f*u+p*c+d,n[3]=v*c+y*u+_,n[4]=f*u+p*l+d,n[5]=v*l+y*u+_,n[6]=f*s+p*l+d,n[7]=v*l+y*s+_,this.proj._activeProjection&&this.proj._activeProjection.surface.boundsQuad(n,n,this.proj._activeProjection.legacy.worldTransform)}}},{key:"worldTransform",get:function(){return this.proj}}]),r}(k.a);k.a.prototype.convertTo2s=function(){this.proj||(this.pluginName="sprite_bilinear",this.aTrans=new m.d,this.calculateVertices=Ot.prototype.calculateVertices,this.calculateTrimmedVertices=Ot.prototype.calculateTrimmedVertices,this._calculateBounds=Ot.prototype._calculateBounds,x.b.prototype.convertTo2s.call(this))},x.b.prototype.convertTo2s=function(){this.proj||(this.proj=new Mt(this.transform),Object.defineProperty(this,"worldTransform",{get:function(){return this.proj},enumerable:!0,configurable:!0}))},x.b.prototype.convertSubtreeTo2s=function(){this.convertTo2s();for(var t=0;t<this.children.length;t++)this.children[t].convertSubtreeTo2s()};var Ct=function(t){c(r,t);var e=f(r);function r(t,i,n){var o;return Object(s.a)(this,r),o=e.call(this,t,i,n),r.prototype.__init.call(a(o)),o.proj=new Mt(o.transform),o.pluginName="batch_bilinear",o}return Object(o.a)(r,[{key:"__init",value:function(){this.aTrans=new m.d}},{key:"worldTransform",get:function(){return this.proj}}]),r}(w.b);Ct.prototype.calculateVertices=Ot.prototype.calculateVertices,Ct.prototype.calculateTrimmedVertices=Ot.prototype.calculateTrimmedVertices,Ct.prototype._calculateBounds=Ot.prototype._calculateBounds,v.S.registerPlugin("batch_bilinear",mt.create({}))}}]);
//# sourceMappingURL=16.9ba91511.chunk.js.map